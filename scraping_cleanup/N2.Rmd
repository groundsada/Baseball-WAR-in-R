---
title: "R Notebook"
output: html_notebook
---

# Clean up Rank

```{r}
library(dplyr)

# Read the datasets
merged_data <- read.csv("dataset/merged_data.csv", fileEncoding = "UTF-8")
rank_data <- read.csv("dataset/rank.csv", fileEncoding = "UTF-8")
```

```{r}
head(merged_data)
```


```{r}
merged_data$Name <- tolower(merged_data$Name)
# Replace all non-alphabetic characters with spaces
merged_data$Name <- gsub("[^a-z ]", " ", merged_data$Name)

# Remove trailing "hof" from player names
merged_data$Name <- gsub("hof\\s*$", "", merged_data$Name)

# Remove leading and trailing whitespaces
merged_data$Name <- gsub("^\\s+|\\s+$", "", merged_data$Name)

rank_data$Player <- tolower(rank_data$Player)
rank_data$Player <- gsub("[^a-z ]", " ", rank_data$Player)
rank_data$Player <- gsub("\\s+$", "", rank_data$Player)
rank_data$Player <- gsub("^\\s+", "", rank_data$Player)

rank_data$Team[rank_data$Team == "LA"] <- "LAD"
rank_data$Team[rank_data$Team == "SF"] <- "SFG"
rank_data$Team[rank_data$Team == "SD"] <- "SDP"
rank_data$Team[rank_data$Team == "KC"] <- "KCR"
rank_data$Team[rank_data$Team == "CWS"] <- "CHW"
rank_data$Team[rank_data$Team == "TB"] <- "TBR"
rank_data$Team[rank_data$Team == "NY"] <- "NYY" # Example for New York Yankees, if needed
rank_data$Team[rank_data$Team == "CHI"] <- "CHC" # Example for Chicago Cubs, if needed
rank_data$Team[rank_data$Team == "FLA"] <- "MIA"
rank_data$Team[rank_data$Team == "WSH"] <- "WAS"
```

```{r}
standard_teams <- c("ARI", "ATL", "BAL", "BOS", "CHC", "CIN", "CLE", "COL", "CWS", "DET", "HOU", "KC", "LAA", "LAD", "MIA", "MIL", "MIN", "NYM", "NYY", "OAK", "PHI", "PIT", "SD", "SEA", "SF", "STL", "TB", "TEX", "TOR", "WAS")

# Extract unique team names from rank_data
unique_teams <- unique(rank_data$Team)

# Identify which of these are not in the standard list
unique_teams[!unique_teams %in% standard_teams]
```

```{r}
colnames(merged_data)[colnames(merged_data) == "Name"] <- "Player"
colnames(merged_data)[colnames(merged_data) == "Season"] <- "Year"
colnames(merged_data)[colnames(merged_data) == "Team"] <- "Team"
```


```{r}
check_match <- left_join(rank_data, merged_data, by = c("Player", "Team", "Year"))
```


```{r}
unmatched_rows <- check_match[is.na(check_match$Age), ]
print(unmatched_rows)
```


## There are 81 rows in the ranked data that have no match in merged_data, for those we have to investigate one, by one.

## applied fixes

```{r}

# fixes:

rank_data$Team[rank_data$Team == "WSH"] <- "WSN"
rank_data$Team[rank_data$Team == "WAS"] <- "WSN"


rank_data$Player <- gsub("carlos ivan beltran", "carlos beltran", rank_data$Player)
rank_data$Player <- gsub("adam a lind", "adam lind", rank_data$Player)
rank_data$Player <- gsub("carl demonte crawford", "carl crawford", rank_data$Player)
rank_data$Player <- gsub("hong chih kuo", "hung chih kuo", rank_data$Player)
rank_data$Player <- gsub("mike anthony napoli", "mike napoli", rank_data$Player)
rank_data$Player <- gsub("michael morse", "mike morse", rank_data$Player)
rank_data$Player <- gsub("henderson alvarez", "henderson alvarez iii", rank_data$Player)

rank_data[rank_data$Player == "johnny damon" & rank_data$Year == 2009, "Team"] <- "NYY"

# Change team to 'STL' for Joel Pineiro in 2009
rank_data[rank_data$Player == "joel pineiro" & rank_data$Year == 2009, "Team"] <- "STL"

# Change team to 'LAD' for Randy Wolf in 2009
rank_data[rank_data$Player == "randy wolf" & rank_data$Year == 2009, "Team"] <- "LAD"

# Change team to 'HOU' for Miguel Tejada in 2009
rank_data[rank_data$Player == "miguel tejada" & rank_data$Year == 2009, "Team"] <- "HOU"

# Change team to 'TOR' for Marco Scutaro in 2009
rank_data[rank_data$Player == "marco scutaro" & rank_data$Year == 2009, "Team"] <- "TOR"

# Change team to 'DET' for Edwin Jackson in 2009
rank_data[rank_data$Player == "edwin jackson" & rank_data$Year == 2009, "Team"] <- "DET"

# Change team to 'DET' for Curtis Granderson in 2009
rank_data[rank_data$Player == "curtis granderson" & rank_data$Year == 2009, "Team"] <- "DET"

# Change team to 'DET' for Fernando Rodney in 2009
rank_data[rank_data$Player == "fernando rodney" & rank_data$Year == 2009, "Team"] <- "DET"
```

```{r}
check_match <- left_join(rank_data, merged_data, by = c("Player", "Team", "Year"))
unmatched_rows <- check_match[is.na(check_match$Age), ]
print(unmatched_rows)
```




```{r}
merged_data <- merge(merged_data, rank_data[, c("Player", "Team", "Year", "Rank")], 
                     by = c("Player", "Team", "Year"), all.x = TRUE)

# Renaming the 'Rank' column to 'top_100' and replacing NA with "No"
merged_data$top_100 <- ifelse(is.na(merged_data$Rank), "No", merged_data$Rank)

# Drop the original 'Rank' column if no longer needed
merged_data$Rank <- NULL

# Print the updated merged_data to check
print(head(merged_data))
```

```{r}
# Print the total number of rows in merged_data
total_rows <- nrow(merged_data)
print(paste("Total number of rows in merged_data:", total_rows))

rank_1_to_100 <- sum(as.numeric(as.character(merged_data$top_100)) >= 1 & 
                     as.numeric(as.character(merged_data$top_100)) <= 100, na.rm = TRUE)
print(paste("Number of rows with rank between 1 and 100:", rank_1_to_100))

# Count and print the number of rows with rank 'No'
rank_no <- sum(merged_data$top_100 == "No", na.rm = TRUE)
print(paste("Number of rows with rank 'No':", rank_no))

# Count and print the number of rows with any different rank (if applicable)
# This assumes there might be other unexpected rank values
different_rank <- sum(!merged_data$top_100 %in% c(1:100, "No"), na.rm = TRUE)
print(paste("Number of rows with different or unexpected rank:", different_rank))

```


```{r}
# Splitting the data into two datasets
master_rank <- merged_data[merged_data$Year >= 2008, ]
master_no_rank <- merged_data[merged_data$Year < 2008, ]

# Removing the 'top_100' column from master_no_rank
master_no_rank$top_100 <- NULL

# Writing datasets to CSV files
write.csv(master_rank, "dataset/master_rank.csv", row.names = FALSE)
write.csv(master_no_rank, "dataset/master_no_rank.csv", row.names = FALSE)

# Reading back the first file to confirm the number of ranks
master_rank <- read.csv("dataset/master_rank.csv")

# Calculate and print the number of ranks between 1 and 100
rank_1_to_100 <- sum(as.numeric(as.character(master_rank$top_100)) >= 1 & 
                     as.numeric(as.character(master_rank$top_100)) <= 100, na.rm = TRUE)
print(paste("Number of rows with rank between 1 and 100:", rank_1_to_100))

```












